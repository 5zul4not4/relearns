(function(G,P){typeof exports=="object"&&typeof module=="object"?module.exports=P():typeof define=="function"&&define.amd?define([],P):typeof exports=="object"?exports["for-widgets-server"]=P():G["for-widgets-server"]=P()})(this,function(){return function(){"use strict";var U={};(function(){U.d=function(a,n){for(var c in n)U.o(n,c)&&!U.o(a,c)&&Object.defineProperty(a,c,{enumerable:!0,get:n[c]})}})(),function(){U.o=function(a,n){return Object.prototype.hasOwnProperty.call(a,n)}}();var G={};U.d(G,{default:function(){return De}});const P=()=>{window.getIframeWindow===void 0&&(window.getIframeWindow=function(n){var c;if(n.contentWindow)return n.contentWindow;if(n.window)return n.window;if(!c&&n.contentDocument&&(c=n.contentDocument),!c&&n.document&&(c=n.document),c&&c.defaultView)return c.defaultView;if(c&&c.parentWindow)return c.parentWindow}),typeof window.XD=="undefined"&&(window.XD=function(){var a,n,c=1,m;return{postMessage:function(y,i,s){if(!i)return;let r=s||window.parent;if(window.postMessage){var o=i.replace(/([^:]+:\/\/[^/]+).*/,"$1");if("postMessage"in r||(r=window.getIframeWindow(r)),!r)return;o.indexOf("file://")===0&&(o="*"),r.postMessage(y,o)}else i&&(r.location=`${i.replace(/#.*$/,"")}#${+new Date}${c++}&${y}`)},receiveMessage:function(y,i){window.postMessage?(y&&(m=function(s){var r=window.location.search.split("?").join(""),o=r.indexOf("offline_forms=true")>-1||r.indexOf("offline_forms=si")>-1;if(!o&&(typeof i=="string"&&s.origin!==i||Object.prototype.toString.call(i)==="[object Function]"&&i(s.origin)===!1))return!1;y(s)}),window.addEventListener?window[y?"addEventListener":"removeEventListener"]("message",m,!1):window[y?"attachEvent":"detachEvent"]("onmessage",m)):(a&&clearInterval(a),a=null,y&&(a=setInterval(()=>{var{hash:s}=document.location,r=/^#?\d+&/;s!==n&&r.test(s)&&(n=s,y({data:s.replace(r,"")}))},100)))}}}())},je=()=>{function a(n,c){var m,{defaultView:y}=n.ownerDocument||document;if(y&&y.getComputedStyle)return c=c.replace(/([A-Z])/g,"-$1").toLowerCase(),y.getComputedStyle(n,null).getPropertyValue(c);if(n.currentStyle)return c=c.replace(/-(\w)/g,(i,s)=>s.toUpperCase()),m=n.currentStyle[c],/^\d+(em|pt|%|ex)?$/i.test(m)?function(i){var s=n.style.left,r=n.runtimeStyle.left;return n.runtimeStyle.left=n.currentStyle.left,n.style.left=i||0,i=`${n.style.pixelLeft}px`,n.style.left=s,n.runtimeStyle.left=r,i}(m):m}window.getStyle||(window.getStyle=a)},We=()=>{window.JCFServerCommon===void 0&&(window.JCFServerCommon={frames:{},func:{}})};function ge(){var a=!!window.CardForm;function n(i){window.$H(i).each(s=>{var r=s.key,o=s.value;try{switch(o.type){case"control_scale":case"control_radio":if(o.name==null)var h=window.$window.$(`#id_${r} input[type="radio"]`);else var h=document.getElementsByName(`q${r}_${o.type=="control_radio"||o.type=="control_scale"?o.name:r}`);window.$A(h).each(t=>{t.value==o.value?(t.checked=!0,t.writeAttribute("checked","checked"),m(t),t.checked=!0):o.items.other!=null&&(window.$(`other_${r}`).checked=!0,window.$(`other_${r}`).writeAttribute("checked","checked"),window.$(`input_${r}`).value=o.items.other,m(window.$(`input_${r}`)),window.$(`input_${r}`).checked=!0)});break;case"control_checkbox":var k=window.$window.$(`#id_${r} input[type="checkbox"]`);window.$A(k).each(t=>{t.checked=!1,t.removeAttribute("checked"),Object.prototype.toString.call(o.items)==="[object Array]"?o.items.include(t.value)&&(t.checked=!0,t.writeAttribute("checked","checked"),m(t),t.checked=!0):Object.values(o.items).include(t.value)?(t.checked=!0,t.writeAttribute("checked","checked"),m(t),t.checked=!0):o.items.other!=null&&(window.$(`other_${r}`).checked=!0,window.$(`other_${r}`).writeAttribute("checked","checked"),window.$(`input_${r}`).disabled=!1,window.$(`input_${r}`).value=o.items.other,m(t),window.$(`input_${r}`).checked=!0)});break;case"control_yesno":var oe=window.$window.$(`#id_${r} input[type="radio"]`);window.$A(oe).each(t=>{t.value===o.value&&(t.checked=!0,t.writeAttribute("checked","checked"),m(t),t.checked=!0)});break;case"control_dropdown":var b=window.$(`input_${r}`);if(b){if(a){var M=b.up().querySelector("div.jfInput-dropdown").classList.contains("isMultiple");if(M){var _=o.items[0].split(",");_.forEach(t=>{b.querySelector(`option[value="${t}"]`).selected=!0})}else b.putValue(o.value)}else if(b.hasAttribute("multiple")){var V=window.$window.$(`#id_${r} option`);window.$A(V).each(t=>{o.items.include(t.value)&&(t.selected=!0)})}else b.putValue(o.value);b.triggerEvent("change")}break;case"control_rating":if(a){var ce=document.getElementById(`input_${r}_${o.value}`);ce.checked=!0,m(ce)}else window.$(`input_${r}`)&&window.$(`input_${r}`).setRating(o.value);break;case"control_datetime":case"control_fullname":if(window.$H(o.items).each(t=>{window.$(`${t.key}_${r}`)&&(window.$(`${t.key}_${r}`).value=t.value||"",window.$(`${t.key}_${r}`).triggerEvent("change"))}),window.$(`lite_mode_${r}`)){var N=o.items;"year"in N&&"month"in N&&"day"in N&&N.year!==""&&N.month!==""&&N.day!==""&&JotForm.formatDate({date:new Date(N.year,N.month-1,N.day),dateField:window.$(`id_${r}`)})}break;case"control_emojislider":for(var p=document.getElementById(`cid_${r}`),oe=p.querySelectorAll("input[type=radio]"),W=0,Z,ne=0;Z=oe[ne];ne++)Z.value===o.value&&(Z.checked=!0,W=ne);var ae=p.querySelector(".js-emojiSlider");ae.addClassName("isFilled");var pe=ae.querySelectorAll(".js-emojiScaleSep"),K=pe[W].getAttribute("data-scale"),$e=ae.querySelector(".js-emojiSlider-faceList");$e.style.width=`${K}%`;var B=$e.querySelectorAll(".js-emojiFaces");B.forEach(t=>{t.removeClassName("isVisible")}),B[W].addClassName("isVisible");break;case"control_phone":case"control_birthdate":case"control_address":case"control_time":if(window.$H(o.items).each(t=>{window.$(`input_${r}_${t.key}`)&&window.$(`input_${r}_${t.key}`).putValue(t.value)}),o.type==="control_time"&&window.$(`input_${r}_hourSelect`)){var C=o.items.hourSelect?o.items.hourSelect:"";if(C&&window.$(`input_${r}_hourSelect`).triggerEvent){if(window.$(`input_${r}_timeInput`)){C.length===1&&C<10&&(C=`0${C}`,window.$(`input_${r}_hourSelect`).putValue(C));var j=window.$(`input_${r}_minuteSelect`).value;j.length===1&&j<10&&(j=`0${j}`),window.$(`input_${r}_timeInput`).putValue(`${C}:${j}`)}else C.length===2&&C.charAt(0)=="0"&&(C=C.slice(1),window.$(`input_${r}_hourSelect`).putValue(C));window.$(`input_${r}_hourSelect`).triggerEvent("change")}}break;case"control_email":var L=window.$(`input_${r}`);if(L){L.putValue(o.value),L.triggerEvent("change");var D=window.$(`input_${r}_confirm`);D&&(D.putValue(o.value),D.triggerEvent("change"))}break;case"control_textarea":if(o.value.length>0){var A=window.$(`input_${r}`);A.up("div").down(".nicEdit-main")&&nicEditors&&nicEditors.findEditor(`input_${r}`)&&nicEditors.findEditor(`input_${r}`).setContent(o.value),A.putValue(o.value),m(A),a&&Array.prototype.forEach.call(CardForm.cards,(t,e)=>{t.question.id===r&&t.markdownEditor&&t.markdownEditor.setHtmlFromMarkdown&&t.markdownEditor.setHtmlFromMarkdown()}),A.hasClassName("form-custom-hint")&&(A.removeClassName("form-custom-hint").removeAttribute("spellcheck"),A.hasContent=!0,A.run("focus"))}else A.hasClassName("form-custom-hint")&&A.run("blur");break;default:window.$(`input_${r}`)&&(window.$(`input_${r}`).putValue(o.value),window.$(`input_${r}`).triggerEvent("change"));break}}catch(t){}})}function c(i){i.forEach(s=>{var{qid:r}=s,o=window.$(`input_${r}`),{type:h}=s;switch(h){case"control_scale":case"control_radio":var k=window.$window.$(`#id_${r} input[type="radio"]`);window.$A(k).each(_=>{_.checked=!1,_.removeAttribute("checked"),m(_)});break;case"control_checkbox":var b=window.$window.$(`#id_${r} input[type="checkbox"]`);window.$A(b).each(_=>{_.checked=!1,_.removeAttribute("checked"),m(_)});break;case"control_yesno":break;case"control_rating":if(a){var k=window.$window.$(`#id_${r} input[type="radio"]`);window.$A(k).each(V=>{V.checked&&(V.checked=!1,V.click())}),window.$window.$(`#id_${r} li`).invoke("removeClassName","checked"),window.$window.$(`#id_${r} input[type="hidden"]`).last().putValue("")}else window.$(`input_${r}`).setRating("");break;case"control_datetime":case"control_fullname":window.$window.$(`input[id*=_${r}]`).each(_=>{_.putValue("")});break;case"control_emojislider":break;case"control_phone":case"control_birthdate":case"control_address":case"control_time":window.$window.$(`[id*=input_${r}]`).each(_=>{_.putValue("")}),h==="control_time"&&window.$(`input_${r}_hourSelect`)&&window.$(`input_${r}_hourSelect`).triggerEvent&&window.$(`input_${r}_hourSelect`).triggerEvent("change");break;case"control_email":case"control_textarea":case"control_dropdown":default:if(o&&(o.putValue(""),o.triggerEvent("change"),h==="control_email")){var M=window.$(`input_${r}_confirm`);M&&(M.putValue(""),M.triggerEvent("change"))}break}})}function m(i){if(i.type&&i.type.match(/checkbox|radio/)){var s=window.scrollX,r=window.scrollY;["click","change"].forEach(o=>{i.triggerEvent(o)}),r!==window.scrollY&&window.scrollTo(s,r);return}i.triggerEvent("change")}function y(i,s){var r={};switch(s=`${s}`,i){case"control_fullname":var o=s.replace(/^\s+|\s+$/g,"");o=o.split(/\s+/g),r={first:o[0],last:o[1]},o.length==3&&(r.middle=o[1],r.last=o[2]);break;case"control_checkbox":case"control_dropdown":r=s.split(/\r\n|\r|\n|\,|\<br\>/g);break;case"control_phone":var h=s.split(/\s+/g);r={area:h[0],phone:h[1],full:s};break;case"control_time":if(/^([0]?\d|[1][0-2]):([0-5]\d)\s?(?:AM|PM)$/.test(s)||/^(2[0-3]|[01]?[0-9]):([0-5]?[0-9])$/.test(s)){var k=s.split(" ");if(k.length>0){var b=k[0].split(":");r={ampm:k[1],hourSelect:b[0],minuteSelect:b[1]}}}break}return r}return{parse:n,clear:c,generateCtrlItems:y}}function Ge(a,n=300){let c;return(...m)=>{clearTimeout(c),c=setTimeout(()=>{a.apply(this,m)},n)}}var Le={t:null,submitted:!1,submit:function(a,n){this.submitted!==!0&&(a.submit(),this.submitted=!0,JotForm.disableButtons())}};function qe(a){var n=document.getElementById(`customFieldFrame_${a}`),c=document.documentElement.clientHeight,m=document.documentElement.clientWidth,y=window&&window.newDefaultTheme||"",i=!1,s=JotForm.forms[0]==null||typeof JotForm.forms[0]=="undefined"?$($$(".jotform-form")[0].id):JotForm.forms[0];if(~["70261670492960","62754049811963","62261204289958","62702584435962","62802961818967","72134468218962"].indexOf(s.id)&&(i=!0),!n.hasClassName("custom-field-frame-rendered")){i&&console.log("Not rendered yet for",a);return}if(N(a))return;JCFServerCommon.frames[a]={},JCFServerCommon.frames[a].obj=n;var{src:r}=n;JCFServerCommon.frames[a].src=r,JCFServerCommon.submitFrames=[];var o=!0,h=!1,k=r;function b(){var t=navigator.userAgent.match(/(?:MSIE |Trident\/.*; rv:)(\d+)/);return t?parseInt(t[1]):void 0}function M(){return JotForm.validateAll()&&$$(".form-line-error").length===0}function _(t){try{JSON.parse(t)}catch(e){return!1}return!0}function V(t){if(t==null)return!0;if(t.constructor===Array||t.constructor===String)return t.length===0;for(var e in t)if(t.hasOwnProperty(e))return!1;return!0}function ce(t){return b()===8?t.replace(/^\s+|\s+$/g,""):t.trim()}function N(t){var e=!1,w=document.getElementById(`customFieldFrame_${t}`);if(w.hasAttribute("data-type")){var d=w.readAttribute("data-type");d==="oembed"&&(e=!0)}return e}function p(t,e,w){var d=k;w!==void 0&&(d=w);var E=document.getElementById(`customFieldFrame_${e}`);E!==null&&(navigator.userAgent.indexOf("Firefox")!=-1?XD.postMessage(t,d,getIframeWindow(E)):b()!==void 0?XD.postMessage(t,d,E):XD.postMessage(t,d,getIframeWindow(E)))}window.sendMessage2Widget=p;function oe(){var t={width:document.documentElement.clientWidth,height:document.documentElement.clientHeight};p(JSON.stringify({type:"frame:resize",frameSizes:t}),a)}window.onresize=oe;function W(){var t=document.getElementById(`widget_settings_${a}`);return t?t.value:null}function Z(t,e){var w=null;return function(){var d=this,E=arguments;clearTimeout(w),w=setTimeout(()=>{t.apply(d,E)},e)}}function ne(t){var e=document.getElementById(`input_${t}`);return!!(e&&e.hasClassName("widget-static"))}function ae(t){var e=document.getElementById(`id_${t}`).className;return e.indexOf("jf-required")>-1}function pe(t){var e=document.getElementById(`label_${t}`);return e?e.className.indexOf("form-label")>-1:!1}function K(t){var e=document.getElementById(`customFieldFrame_${t}`);return!(!e.hasClassName("frame-ready")&&!e.retrieve("frame-ready"))}function $e(){return JotForm.isEditMode()||!!~window.location.href.indexOf("/edit/")||!!~window.location.href.indexOf("inlineEdit")}function B(t){var e=document.querySelector(".form-all"),w=window.getComputedStyle?window.getComputedStyle(e,null).getPropertyValue("background-color"):getStyle(e,"background"),d=window.getComputedStyle?window.getComputedStyle(e,null).getPropertyValue("font-family"):getStyle(e,"font-family"),E=window.FORM_MODE=="cardform"||window.buildermode==="card",ue=window&&window.newDefaultTheme||"",ye=window&&window.JotForm.extendsNewTheme||"",v={type:"ready",qid:`${t}`,formID:document.getElementsByName("formID")[0].value,required:ae(t),static:ne(t),isWidgetLabelEnabled:pe(t),jotformNext:window.location.href.indexOf("jotformNext=1")>-1||window.isComingFromJotFormNext==1,cardform:E,background:w,fontFamily:d,origin:window.location.origin||`${window.location.protocol}//${window.location.hostname}${window.location.port?`:${window.location.port}`:""}`,enterprise:JotForm.enterprise,themeVersion:ue,isExtendedTheme:ye},H=W();H&&decodeURIComponent(H)!=="[]"&&(v.settings=H);var g=document.getElementById(`customFieldFrame_${t}`);if(E&&g&&typeof g.up=="function"){var R=g.up(".jfField")||!1,T=R&&typeof R.getAttribute=="function"?R.getAttribute("data-widget-id"):!1;T&&(v.widgetID=T)}var Q=g.readAttribute("data-width")||g.parentNode.clientWidth,de=g.readAttribute("data-height")||g.parentNode.clientHeight;v.width=parseInt(Q),v.height=parseInt(de),v.viewWidth=g.parentNode.clientWidth,v.viewHeight=g.parentNode.clientHeight;function fe(ve,be){$(document.getElementById(`customFieldFrame_${ve}`)).addClassName("frame-ready").store("frame-ready",!0),p(JSON.stringify(be),ve)}var he=JotForm.isEditMode()||!!~window.location.href.indexOf("/edit/")||!!~window.location.href.indexOf("inlineEdit");if(i&&console.log("ready message inline",v),he)var me=50,Y=5e3,F=0,I=setInterval(()=>{(g.hasAttribute("data-value")||F>=Y)&&(clearInterval(I),v.value=g.getAttribute("data-value"),i&&console.log("Ready message sent in",F,v),fe(t,v)),F+=me},me);else{if(g.hasAttribute("data-value"))v.value=g.getAttribute("data-value");else{var q=g.parentNode.select(`#input_${t}`);q.first().getValue()&&(v.state="oldvalue",v.value=q.first().getValue())}i&&console.log("Sending normal ready message",v),fe(t,v)}}function C(t){var e=document.createElement("textarea");return e.innerHTML=t,e.value}function j(t){var e=document.createElement("textarea");return e.textContent=t,e.innerHTML}window.JCFServerCommon.frames[a].sendReadyMessage=B,XD.receiveMessage(t=>{if(_(t.data)){var e=JSON.parse(t.data);if(i&&console.log("Data from widget",e.qid,e),parseInt(a)===parseInt(e.qid)){if(e.type==="submit"){if(i&&console.log("widget submit",document.getElementById(`input_${e.qid}`)),document.getElementById(`input_${e.qid}`)){typeof e.value=="number"&&(e.value=`${e.value}`);var w=$(document.getElementById(`input_${e.qid}`)).hasClassName("widget-required")||$(document.getElementById(`input_${e.qid}`)).hasClassName("validate[required]"),d=document.getElementById(`input_${e.qid}`),E=d.up(".form-line"),ue=function(l){return l.match(/^data:image\/png;base64/ig)||!!~l.indexOf("widget_metadata")||_(l)},ye=JotForm.isVisible(E),v=!(E.hasClassName("form-field-hidden")||d.hasClassName("always-hidden")||!ye);if(w)if(i&&console.log(e.qid,"isVisible",v),v&&"valid"in e&&(e.valid===!1||e.valid===!0&&!e.value)){if(K(e.qid)?(d.setValue(""),i&&console.log("LogA: Setting empty input value for",e.qid,e)):i&&console.log("LogA: Setting nothing because isn't ready",e.qid,e),!d.getValue()){var H=JotForm.texts.required||"This field is required";typeof e.error!="undefined"&&e.error!==!1&&(H=e.error.hasOwnProperty("msg")?e.error.msg:H),i&&console.log("Errored required element",d,e),JotForm.errored(d,H)}}else if(v&&!JotForm.isCollapsed(d)&&(i&&console.log("Correcting required element",d,e),JotForm.corrected(d)),!v&&e.valid===!0&&(i&&console.log("Correcting not visible element but valid",d,e),JotForm.corrected(d)),K(e.qid))if(e.value!==void 0){var g=e.value;JotForm.isEncrypted&&e.value&&!ue(e.value)&&(g=JotEncrypted.encrypt(e.value)),d.setValue(j(g)),i&&console.log("LogB: Setting input value for",e.qid,e)}else d.setValue(""),i&&console.log("LogC: Setting input value for",e.qid,e);else i&&console.log("LogA: Widget frame not ready, no value set",e.qid,e);else if(typeof e!="undefined")if("value"in e)if(K(e.qid)){var g=e.value;JotForm.isEncrypted&&e.value&&!ue(e.value)&&(g=JotEncrypted.encrypt(e.value)),d.setValue(j(g))}else i&&console.log("LogB: Widget frame not ready, no value set",e.qid,e);else d.hasClassName("widget-static")&&(d.setValue(""),d.removeAttribute("name"));d&&E&&E.hasClassName("form-field-hidden")&&JotForm.clearFieldOnHide==="disable"&&d.setValue(""),JCFServerCommon.submitFrames.indexOf(parseInt(e.qid))<0&&(v&&w&&!e.valid?i&&console.log("Waiting for frame submission, required but not valid",e.qid):JCFServerCommon.submitFrames.push(parseInt(e.qid)))}for(var R=$$(".widget-required, .widget-errored"),T=!0,Q=0;Q<R.length;Q++)R[Q].value.length===0&&JotForm.isVisible(R[Q])&&(T=!1);if(!o)if(i&&console.log("next page",o,M(),T),M()&&T){i&&console.log("sendSubmit",o,T);var de=JotForm.forms[0]==null||typeof JotForm.forms[0]=="undefined"?$($$(".jotform-form")[0].id):JotForm.forms[0],fe=!!~window.location.href.indexOf("/edit/")||window.location.search.match("inlineEdit|edit"),he=["stripe","braintree","square","wepay","eway","bluepay","moneris","paypalcomplete","mollie","stripeACHManual","pagseguro"];if(!(JotForm.payment&&he.indexOf(JotForm.payment)>-1&&JotForm.isPaymentSelected()&&JotForm.paymentTotal>0&&!fe||JotForm.isEncrypted||JotForm.disableSubmitButton||window.offlineForm))if($$('.custom-field-frame[data-type="iframe"]').length===JCFServerCommon.submitFrames.length){i&&console.log("All frames submitted",JCFServerCommon.submitFrames);var me=Z(()=>Le.submit(de));me()}else i&&console.log("Not all frames submitted",JCFServerCommon.submitFrames)}else JotForm.enableButtons(),JotForm.showButtonMessage(),JCFServerCommon.submitFrames=[]}else if(e.type==="data"){try{var Y=document.getElementById(`input_${e.qid}`);Y&&(Y.value=e.value,Y.triggerEvent("change"),e.value&&y&&y==="v2"&&JotForm.corrected(Y))}catch(l){console.log(l)}JotForm.triggerWidgetCondition(e.qid),JotForm.triggerWidgetCalculation(e.qid)}else if(e.type==="errors"){var F=document.getElementById(`input_${e.qid}`);e.action==="show"?JotForm.isVisible(F)&&(JotForm.corrected(F),F.value="",F.addClassName("widget-errored"),JotForm.errored(F,e.msg),"resetForm"in e&&e.resetForm===!0&&JotForm.enableButtons()):e.action==="hide"&&(F.removeClassName("widget-errored"),JotForm.corrected(F))}else if(e.type==="required"){var F=document.getElementById(`input_${e.qid}`);e.action==="set"&&!F.hasClassName("widget-required")?F.addClassName("widget-required"):e.action==="unset"&&(F.removeClassName("widget-required"),JotForm.corrected(F))}else if(e.type==="form:trackerID")p(JSON.stringify({eventID:e.eventID,type:"event:receiver",data:$$('[name="event_id"]')[0]?$$('[name="event_id"]')[0].value:""}),e.qid);else if(e.type==="size"){var{width:I}=e,{height:q}=e;I!=null&&(Number(I)===0&&(I="auto"),typeof I=="number"&&(I=`${I}px`),document.getElementById(`customFieldFrame_${e.qid}`).style.width=I),q!=null&&(+(q===0)&&(q="auto"),typeof q=="number"&&(q=`${q}px`),document.getElementById(`customFieldFrame_${e.qid}`).style.height=q,b()!==void 0&&(document.getElementById(`cid_${e.qid}`).style.height=q)),JotForm.iframeHeightCaller()}else if(e.type==="styles")"styles"in e&&!V(e.styles)&&$(`customFieldFrame_${e.qid}`).setStyle(e.styles);else if(e.type==="replace")try{var{inputType:ve}=e,{isMobile:be}=e,He=e.required,_e=$(`customFieldFrame_${e.qid}`).up(),Fe=$(`input_${e.qid}`).readAttribute("name");$(`customFieldFrame_${e.qid}`).remove(),$(`input_${e.qid}`).up().remove();var ee="",te=He?"validate[required] widget-required widget-replaced":"";switch(ve){case"control_fileupload":var de=JotForm.forms[0]==null||typeof JotForm.forms[0]=="undefined"?$($$(".jotform-form")[0].id):JotForm.forms[0];de.setAttribute("enctype","multipart/form-data"),be||(te=te===""?"validate[upload]":te,ee=`<input class="form-upload ${te}" type="file" id="input_${e.qid}" name="${Fe}" file-accept="pdf, doc, docx, xls, xlsx, csv, txt, rtf, html, zip, mp3, wma, mpg, flv, avi, jpg, jpeg, png, gif"file-maxsize="10240">`),_e.insert(ee);break;case"control_textbox":ee=`<input class="form-textbox ${te}" type="text" data-type-"input-textbox" id="input_${e.qid}" name="${Fe}">`,_e.insert(ee);break;case"control_textarea":ee=`<textarea class="form-textarea ${te}" type="text" id="input_${e.qid}" name="${Fe}" cols="40" rows="6"></textarea>`,_e.insert(ee);break;default:break}}catch(l){console.log(l)}else if(e.type==="event:listener"){var le=document.getElementById(e.field);if(le&&["keyup","change"].indexOf(e.event)>-1){i&&console.log("Event registered from ",e.qid);var xe=function(l){var u=l.target.value;u=typeof u!="undefined"?u:"",i&&console.log("Handler for ",e.qid,"triggered",u,l.target.id),l.target.id===e.field&&(i&&console.log("event:receiver: Sending message to ",e.qid,"with value",u),p(JSON.stringify({eventID:e.eventID,type:"event:receiver",value:u}),e.qid))};Event.observe(le,e.event,e.event==="keyup"?Z(xe,100):xe)}}else if(e.type==="event:store"){var le=document.getElementById(e.field);if(le){var we=$(e.field).up(".form-line").id.split("_")[1],z={eventID:e.eventID,type:"event:receiver",value:e.value};JotForm.getInputType(we)==="widget"||"isWidget"in e&&e.isWidget?(window.console&&"warn"in console&&console.warn("Sending value to destination(widget) from a source(widget) is not recommended."),delete z.eventID,z.field=e.field,z.isWidget=!0,z.targetQID=we,i&&console.log("Sending data to widget field",we,z),p(JSON.stringify(z),we)):(le.setValue(e.value),"hasCallback"in e&&e.hasCallback&&(i&&console.log("Sending data to native field",e),p(JSON.stringify(z),e.qid)))}}else if(e.type==="field:hide")$(`input_${e.qid}`).up(".form-line").hide(),window.FORM_MODE&&window.FORM_MODE=="cardform"&&window.CardForm.setCardVisibility(window.CardForm.cards.filter(l=>l.question.id==e.qid)[0],!1);else if(e.type==="field:show")$(`input_${e.qid}`).up(".form-line").show();else if(e.type==="fields:capture"){var Re=["control_textbox","control_textarea","control_dropdown","control_datetime","control_phone","control_fullname","control_hidden","control_email"],Ee=[],Pe;e.fields.forEach(l=>{var u="",f,O;if(l.match(/\[\w+\]/)){var J=$$(`[name$="_${l}"]`)[0]||!1;J&&(u=J.tagName==="SELECT"?J.getSelected().value:J.value,f=J.up("li.form-line"),O=J.up("li.form-line").getAttribute("data-type"))}else{if(e.identifier==="name"?$$(".form-textbox, .form-dropdown, .form-textarea, .form-hidden").some(S=>{if(S.name.match(new RegExp(`(${l}$)|(${l}\\[)`)))return f=S.up("li")}):f=$(`id_${l}`),O=f?f.getAttribute("data-type"):"",!f||Re.indexOf(O)===-1){Ee.push({selector:l,value:""});return}u=$$(`#${f.id} input, #${f.id} select`).map(S=>S.id==`lite_mode_${f.id}`?"":S.tagName==="SELECT"?S.getSelected().value:S.value).filter(S=>!!S),O==="control_datetime"&&f.down("[id*=lite_mode_]")&&(u=f.down("[id*=lite_mode_]").value),u=u.length<=1?u[0]||"":u}if(typeof u=="object"){var x=" ";switch(O){case"control_datetime":x=f.down(".date-separate")?f.down(".date-separate").innerHTML.replace(/\s|\&nbsp;/g,""):"/";break;case"control_phone":x="-";default:}u=u.join(x)}Ee.push({selector:l,value:u,type:O||""})}),p(JSON.stringify({eventID:e.eventID,type:"event:receiver",data:Ee}),e.qid)}else if(e.type==="fields:fill"){var re={};$$(".form-line").filter(l=>["control_textbox","control_scale","control_radio","control_checkbox","control_dropdown","control_rating","control_datetime","control_fullname","control_phone","control_birthdate","control_address","control_time","control_email","control_textarea","control_emojislider","control_yesno","control_number"].include(l.readAttribute("data-type"))).each((l,u)=>{var f=l.id.split("_")[1],O=l.readAttribute("data-type"),J;window.FORM_MODE&&window.FORM_MODE=="cardform"?J=l.select(".jfQuestion-label").first():J=l.select(".form-label").first();var x=J.clone(!0),S=x.select(".form-required").first()||x.select(".jfRequiredStar").first();S&&S.remove();for(var Xe=x&&(x.innerText||x.textContent)||"",ie={name:"",value:"",items:"",text:ce(Xe.toLowerCase()),type:O},X=0;X<e.fields.length;X++){var Je=!1;if(e.identifier==="label"){var Ue=(e.fields[X].label||"").toString().toLowerCase();Je=ie.text===Ue}else if(e.identifier==="id")Je=Number(f)===Number(e.fields[X].id);else{console.error("Unknown identifier",e.identifier,"use the question label or qid");break}if(Je&&$(`cid_${f}`)){var Me=$(`cid_${f}`).select("input, select, textarea").first();if(Me){ie.name=Me.readAttribute("name").replace(`q${f}_`,""),ie.value=e.fields[X].value;var Be=e.fields[X].items?e.fields[X].items:ge().generateCtrlItems(O,ie.value);V(Be)||(ie.items=Be),f in re||(re[f]={}),re[f]=ie}break}}}),V(re)||(i&&console.log("data props",re),ge().parse(re)),JotForm.runAllCalculations()}else if(e.type==="fields:clear"){var Se=[];e.fields=e.fields.map(l=>l.toLowerCase()),$$(".form-label, .jfQuestion-label").each(l=>{var u=l.clone(!0),f=u.select(".form-required, .jfRequiredStar").first();f&&f.remove();var O=u.innerText.trim().toLowerCase();if(e.fields.indexOf(O)>-1){var J=l.id.match(/_(\d+)$/)[1]||"",x=l.up(".form-line").getAttribute("data-type")||"";J&&x&&Se.push({qid:J,type:x})}});try{ge().clear(Se)}catch(l){console.error(l)}}else if(e.type==="submit:frame:remove"){if(JCFServerCommon.submitFrames.length>0){var ke=JCFServerCommon.submitFrames.indexOf(parseInt(e.qid));ke>=0&&JCFServerCommon.submitFrames.splice(ke,1)}}else if(e.type==="frame:move"){var Ne=document.body.getBoundingClientRect().top,Ce=n.getBoundingClientRect().top-Ne,se=n.up("ul.form-section.page-section");if(se){var Ae=se.getHeight(),Te=new MutationObserver(l=>{if(JotForm.isVisible(n)&&se.getHeight()!==Ae){var u=n.getBoundingClientRect().top-Ne;Math.abs(Ce-u)>5&&(Ae=se.getHeight(),Ce=u,p(JSON.stringify({eventID:e.eventID,type:"event:receiver",data:{position:Ce}}),e.qid))}});Te.observe(se,{subtree:!0,attributes:!0,attributeFilter:["class","style"]})}}else if(e.type==="frame:getdata"){var Oe=0,Ie=0,Ve=0;(window.FORM_MODE=="cardform"||window.buildermode==="card")&&(Oe=document.getElementById(`label_${a}`).clientHeight,Ie=document.getElementsByClassName("jfCard-actions")[0].clientHeight,Ve=document.querySelectorAll(".jfProgress, .no-animate")[0].clientHeight);var ze={width:m,height:c,labelHeight:Oe,actionHeight:Ie,jfProgressHeight:Ve};p(JSON.stringify({type:"event:receiver",eventID:e.eventID,frameData:ze}),e.qid)}}}},n.src.replace(/([^:]+:\/\/[^\/]+).*/,"$1")),n.addClassName("frame-xd-ready").store("frame-xd-ready",!0),i&&console.log("sending settings",W(),new Date().getTime()),p(JSON.stringify({type:"settings",settings:W()}),a),i&&console.log("sending form strings",JotForm.texts,new Date().getTime()),p(JSON.stringify({type:"formstrings",formTexts:JotForm.texts}),a);var L=JotForm.getSection(n);if(n&&JotForm.isVisible(L)&&JotForm.isVisible(n)&&typeof n.up(".form-section-closed")=="undefined")i&&console.log("Frame widget object is visible",JotForm.isVisible(L),JotForm.isVisible(n),typeof n.up(".form-section-closed")=="undefined"),B(a);else if(document.get.jumpToPage){var D=parseInt(document.get.jumpToPage);if(!isNaN(D)&&L===$$(".form-section:not([id^=section_])")[D-1])var A=setInterval(()=>{JotForm.isVisible(n)&&(i&&console.log(`Form jump to widget page (${D}); sending ready message...`),B(a),clearInterval(A))},200)}window.onresize=function(){var t={width:document.documentElement.clientWidth,height:document.documentElement.clientHeight};p(JSON.stringify({type:"frameresize",frameSizes:t}),a)},s.observe("submit",t=>{if(document.getElementById(`customFieldFrame_${a}`)!==null&&$$(".form-submit-button")&&$$(".form-submit-button").length>0){var e=!1;$$(".form-submit-button").each(w=>{JotForm.isVisible(w.parentNode)&&(e=!0)}),t.stop(),e?(o=!1,i&&console.log("Form stopped from widget server event, submitting form from widge submit event"),p(JSON.stringify({type:"submit",qid:`${a}`}),`${a}`)):JotForm.enableButtons()}}),$$(".form-pagebreak-back").each(t=>{$(t).observe("click",()=>{JotForm.currentSection.down(`#customFieldFrame_${a}`)&&!K(a)&&(i&&console.log("Sending ready message to unready widget"),B(a))})}),$$(".form-pagebreak-next").each((t,e)=>{i&&console.log("Going to next page"),$(t).observe("click",function(w){h=this.up(".form-section"),o=!0,h.select(`#customFieldFrame_${a}`).length>0&&(i&&console.log("Sending submit message for iframe id",a,"from section",this.up(".form-section"),"and iframe",n),p(JSON.stringify({type:"submit",method:"next",qid:`${a}`}),`${a}`),Event.stop(w));var d=setInterval(()=>{n=document.getElementById(`customFieldFrame_${a}`),n?(h=$(n).up(".form-section"),JotForm.isVisible(h)&&JotForm.isVisible(n)?(clearInterval(d),i&&console.log("Sending ready message for iframe id",a,"from section",h),B(a)):(i&&console.log("Section and frameObj not visible",h,n),clearInterval(d))):clearInterval(d)},100)})}),$(`input_${a}`)&&["widget:clear","widget:populate","widget:shift"].forEach(t=>{$(`input_${a}`).observe(t,e=>{var{qid:w}=e.memo,d={type:t.replace(":",""),qid:w};t=="widget:populate"&&(d.value=e.memo.value||""),p(JSON.stringify(d),w)})})}P(),je(),We(),window.widgetFrameLoaded=qe;var De={widgetFrameLoaded:qe};return G=G.default,G}()});
